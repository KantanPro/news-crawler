# OpenAI APIキー設定ガイド

## セキュリティ強化について

News Crawlerプラグインでは、セキュリティを強化するため、OpenAI APIキーを暗号化して保存するようになりました。

## 新しいAPIキーの設定手順

### 1. 新しいOpenAI APIキーの取得

1. [OpenAI Platform](https://platform.openai.com/)にログイン
2. 「API Keys」セクションに移動
3. 「Create new secret key」をクリック
4. 新しいAPIキーをコピーして安全な場所に保存

### 2. プラグインでの設定

#### 方法1: 基本設定から設定

1. WordPress管理画面にログイン
2. 「News Crawler」→「基本設定」に移動
3. 「OpenAI APIキー」セクションを確認
4. 既存のAPIキーがある場合は、マスク表示されます
5. 「新しいOpenAI APIキー」フィールドに新しいキーを入力
6. 「設定を保存」をクリック

#### 方法2: 設定管理から設定

1. WordPress管理画面にログイン
2. 「News Crawler」→「設定」→「API設定」タブに移動
3. 「OpenAI API キー」セクションを確認
4. 既存のAPIキーがある場合は、マスク表示されます
5. 「新しいOpenAI APIキー」フィールドに新しいキーを入力
6. 「設定を保存」をクリック

### 3. 設定の確認

1. 「News Crawler」→「設定」→「システム情報」タブに移動
2. 「API接続テスト」を実行
3. 接続が成功することを確認

## セキュリティ機能

### 暗号化保存
- APIキーはAES-256-CBCで暗号化されてデータベースに保存されます
- 暗号化キーはWordPress固有のソルトから生成されます

### マスク表示
- 管理画面ではAPIキーはマスク表示されます（例: `sk-****...****abcd`）
- ログファイルにはAPIキーの一部のみが記録されます

### 自動マイグレーション
- 既存の平文で保存されたAPIキーは自動的に暗号化されます
- プラグインの更新時に自動実行されます

## トラブルシューティング

### APIキーが認識されない場合

1. 新しいAPIキーが正しく入力されているか確認
2. 設定を保存後、ページを再読み込み
3. ブラウザのキャッシュをクリア
4. プラグインを無効化→有効化

### 接続テストが失敗する場合

1. APIキーが有効であることを確認
2. OpenAIアカウントに十分なクレジットがあることを確認
3. ネットワーク接続を確認
4. ファイアウォール設定を確認

## 重要な注意事項

- APIキーは絶対に第三者と共有しないでください
- APIキーをコード内にハードコードしないでください
- 定期的にAPIキーを更新することを推奨します
- 不要になったAPIキーは即座に無効化してください

## サポート

設定で問題が発生した場合は、以下を確認してください：

1. プラグインのバージョンが最新であること
2. WordPressのバージョンが対応していること
3. 必要なPHP拡張機能が有効であること

詳細なサポートが必要な場合は、開発者にお問い合わせください。
